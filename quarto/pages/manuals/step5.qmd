---
title: "Step 5: Renovate data"
subtitle: "Make sure data is in the format as specified in our standards."
pagetitle: "Renovation - Step 5"
execute: 
  echo: false
  warning: false
  error: false
editor_options: 
  chunk_output_type: console
---
 
```{r}
## Data prep
library(tidyverse)
library(reactable)
library(shiny)

load("../fair/files/quarto-f2-objects.rdata")
load("../fair/files/quarto-f3-objects.rdata")
load("../fair/files/renovation-objects.rdata")

## Reactable theming
salurbal_reactable = reactableTheme(
  color = "#5e666d",
  backgroundColor = "#e6ebee",
  borderColor = "black",
  stripedColor = "black",
  highlightColor = "bfc5c9",
  headerStyle = list(
    fontWeight = "bolder",
    fontSize = 'larger',
    borderColor = "#555"
  ),
  searchInputStyle = list(width = "98%",
                          backgroundColor = "#e6ebee",
                          margin = "auto",
                          marginTop = "3px",
                          marginBottom = "3px")
)

## Row styling 
get_row_color = function(description_tmp){
  colorTmp = case_when(
    str_detect(description_tmp,"IDENTIFIERS")~"#f4d7ad",
    str_detect(description_tmp,"STRATA DETAILS")~"#b3e9d5",
    str_detect(description_tmp,"CATEGORIZATION")~"#a3ccdf",
    str_detect(description_tmp,"INTERNAL")~"#ebd7f3",
    str_detect(description_tmp,"DETAILS")~"#c5fbc5",
    TRUE~"#e6ebee"
  )
}
## Local objects
strata_vars = c('var_name','strata_1_name','strata_1_value','strata_2_name','strata_2_value')
```


:::{.callout-important}

## Things you will need 

- Step 5 template:  <a href="../fair/files/data_template.csv" download>ðŸ“¥ data_template.csv</a>
- [Data field definitions](../fair/findable-f2.qmd#data)
:::
 

## Description

To review data format and template can be found in [principle F3 page](../fair/findable-f3.qmd). This step will is just reviewing your data and making sure it adheres to the standards.


## Deliverable

:::{.callout-important}
Step 5 template: <a href="../fair/files/data_template.csv" download>ðŸ“¥ data_template.csv</a>
:::

**For each dataset you should have a data.csv as a deliverable**

:::: {.column-screen-inset-right}

::: {.panel-tabset}


##  Air Pollution Dataset (APS)

**aps_data.csv**


```{r}
aps_data %>% 
  reactable(
    pagination = FALSE, 
    highlight = TRUE,  
    sortable = F,
    height = 500,
    defaultPageSize = 20,
    defaultColDef = colDef(minWidth = 150),
    theme = salurbal_reactable
  )
```


## SEC Census dataset (CNS) 

**cns_data.csv**


```{r}
cns_data %>% 
  reactable(
    pagination = FALSE, 
    highlight = TRUE,  
    sortable = F,
    height = 500,
    defaultPageSize = 20,
    defaultColDef = colDef(minWidth = 150),
    theme = salurbal_reactable
  )
```

## Health Survey (SVY) 

**svy_data.csv**


```{r}
svy_data %>% 
  reactable(
    pagination = FALSE, 
    highlight = TRUE,  
    sortable = F,
    height = 500,
    defaultPageSize = 20,
    defaultColDef = colDef(minWidth = 150),
    theme = salurbal_reactable
  )
```

**Based on the <a href="../fair/files/ex_SVY_codebook_evaluation.csv" download>SVY codebook evaluation</a> we saw:**

- 15 simple fields
- 2 by_country fields (source, public, censor)
- 2 by_strata (var_def, interpretation)

**Therefore we need to prepare three codebooks for this dataset (see below).**



:::

::::


